---

---

# 基础

![image-20240304212301044](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240304212301044.png)

**打开mysql方式**

- **搜索命令提示符（cmd）**

'net start mysql80'

![image-20240304214959928](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240304214959928.png)

通过全局跳到path环境变量再输入

和cmd有一些差别

命令提示符然后管理员运行

- 用cmd命令


![image-20240304215654473](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240304215654473.png)

注意：环境变量配置是系统配置，然后变量名为path，设置成其他的都不管用

`mysql -u root -p`

-u接口、-p密码



**下载安装**

![image-20240305100857449](C:\Users\hxd15\Desktop\Repository\GithubRepository\MySQL_LearningNote\assets\image-20240305100857449.png)



mysql语言分类

![image-20240305101840442](C:\Users\hxd15\Desktop\Repository\GithubRepository\MySQL_LearningNote\assets\image-20240305101840442.png)



## DDL

### **数据库操作**

`查询`

```mysql
show databases;

select database();
```

`创建`

create database (if not exists) `test`;

create schema ……

`删除`

drop database (if exists) `test`;

`使用`

use `test`;



### **表操作**

- **查询**

show tables;

desc  `stuInfo`;

show create table `test`;	查询建表语句

- **创建**

```mysql
create table stuInfo(
	name varchar(10) comment '姓名',
	age int comment '年龄',
	sno varchar(15) comment '学号'
)comment '学生信息表'
```

- **修改**

添加字段

```mysql
-- 默认最后一排
alter table test add address varchar(20)
comment '地址';

-- 指定位置
alter table test add address varchar(20) after name;
alter table test add address varchar(20) first;
```

修改类型

```mysql
alter table test modify age varchar(3);
```

修改字段名和类型

```mysql
alter table test change address tel varchar(15) comment'电话号码';
```





删除字段

```mysql
alter table test drop tel;
```

修改表名

```mysql
alter table rename to stuInfo;
```

- 删除

删除表

```mysql
drop table (if exists) test;
```

删除指定表并重新创建该表

```mysql
truncate table test; # 数据全部丢失
```



移动字段

```mysql
-- 修改字段到第一列
alter table tb_emp modify Name varchar(25) FIRST;

-- 移动到某个字段后一列
alter table tb_emp modify DeptId int(11) AFTER Salary;

--语法规则为： ALTER TABLE 表名 MODIFY 字段1 数据类型 FIRST|AFTER 字段2; 。
```



删除表的外键约束

```mysql
alter table tb_emp drop foreign key emp_dept;
```



数据库名区分大小写





desc 描述

comment  v、评论，n、解释，评论









**字符串类型**

text blob char varchar

char（10)   最大长度 定长字符串 占用空间固定10 

varchar(10)  占用空间取决具体

性能上char高

varchar需要根据内容计算占用空间

**时间类型**

date

time





![image-20240305110406103](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240305110406103.png)

```mysql
create table employee(
	id varchar(10) comment '编号',
	workno varchar(15) comment '员工工号',
	name varchar(10) comment '员工姓名',
	gender char(1) comment '性别',
	age tinyint unsigned comment '年龄',
	idcard char(18) comment '身份证',
	entrydate date comment '入职时间'
)comment '员工信息';
```

` ` `符号是转义符号避免关键字冲突











![image-20240305112946191](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240305112946191.png)





## DML

### 添加数据

**指定数段添加数据**

```mysql
insert into employee(name,tel,address) values('张三','156789456','湖北武汉');
```

字符串，日期都要用‘ ’

- **添加数据**

```mysql
insert into employee values('张三','156789456','湖北武汉',18,'1');
```

- **批量添加数据**

```mysql
insert into employee (name, tel, address) values('张三', '789456' ,'湖北武汉'),('李四', '123456','北京');

insert into employee values('李四','8954612','北京', 19, '1'),('张三','156789456','湖北武汉',18,'2');
```

此处查询存储数据情况语句

```mysql
select * from employee;
```



---



### 修改数据

修改数据默认全修改，如果不加 

- 条件修改

```mysql
update employee set name = '李四' where id = 1;
```

- 全部修改

```mysql
update employee set entryDate = '2024-3-15';
```



---



### 删除数据

修改同理

- 条件删除

```mysql
delete from employee where gender = '女';
```

删除性别为女的信息

- 删除所有

```mysql
delete from employee;
```

删除数据至少为一行

如果需要删除某一个字段的值用update修改为NULL





















---



## DQL

### 基本语法

```mysql
SELECT
 字段列表
FROM
 表名列表
WHERE
 条件列表
GROUP BY
 分组字段列表
HAVING
 分组后条件列表
ORDER BY
 排序字段列表
LIMIT
 分页参数

```



### 基础查询

查询数据，起别名是查询出来的数据顶端有项目名字，方便查看

去除重复记录，查询的数据有重复的不显示

可以将查询进行组合

```mysql
select id,name from employee;

-- 全部查询，可以将字段全列出来
select * from employee;
select id,name,workno,workaddress … from employee;

-- 字段设置别名
SELECT 字段1 [ AS 别名1 ] , 字段2 [ AS 别名2 ] ... FROM 表名;
SELECT 字段1 [ 别名1 ] , 字段2 [ 别名2 ] ... FROM 表名;

select name as '姓名' from employee;

-- 去除重复
select distinct workaddress from employee;
```

正常查询结果如图，起别名后name会变成  姓名

![image-20240315150059861](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240315150059861.png)



### 条件查询

`!=  <>`		不等于

between …… and ……    闭区间

in …… 取in中的某个字段

**like	_匹配单个字符串，%匹配任意字符串**

is null



and	&&

or		||

not		!

```mysql
-- like
-- 查询姓名为两个字符
select * from emp where name like '__';

-- 查询身份证号最后一位是x
select * from emp where name like '%x';
select * from emp where name like '_______________x';
```





### 聚合函数

```mysql
-- count sum
-- max min avg
```

NULL值不参与计算

```mysql
select count (*) from employee; -- 统计记录数

select count(idcard) from employee; -- 统计不能null的idcard数

select count(1) from employee;
```



统计西安地区工作人员年龄之和

```mysql
select sum(age) from employee where address = '西安';
```





### 分组查询

`group by    having  `

```mysql
-- 根据性别分组统计男性员工和女性员工数量
select count(*) from employee group by gender;

-- 根据性别分组统计男性员工和女性员工的平均年龄
select avg(age) from employee group by gender;

-- 查询年龄小于45的员工 , 并根据工作地址分组 , 获取员工数量大于等于3的工作地址

select workaddress,count(*) from employee where age<45 group by workaddress having count(*) >= 3;

-- 别名写法
select workaddress,count(*) [as] address_count from emp where age<45 group by workaddress having address_count >3;

-- 可省略

```



### 排序查询

`order by`



```mysql
-- asc 升序
-- desc 降序

-- 根据年龄对公司的员工进行升序排序
select * from emp order by age asc;
-- 根据入职时间, 对员工进行降序排序
select * from emp order by entrydate desc;

-- 根据年龄对公司的员工进行升序排序 , 年龄相同 , 再按照入职时间进行降序排序
select * from emp order by age asc,entrydate desc;
```



### 分页查询

`select * from emp limit ……`

`SELECT 字段列表 FROM 表名 LIMIT 起始索引, 查询记录数 ;`

```mysql
-- 查询第一页（索引为0）
select * from emp limit 0,5;
select * from emp limit 5;

-- 查询第二页数据，每页5个
select * from emp limit 5,5;

```





### 案例

```mysql
-- 统计员工表中, 年龄小于60岁的 , 男性员工和女性员工的人数

-- 查询所有年龄小于等于35岁员工的姓名和年龄，并对查询结果按年龄升序排序，如果年龄相同按
入职时间降序排序。
select name,age from emp where age<=35 order by age asc,entrydate desc;

-- 查询性别为男，且年龄在20-40 岁(含)以内的前5个员工信息，对查询的结果按年龄升序排序，
年龄相同按入职时间升序排序
select * from emp where age>=20 && age<=40 order by age asc,entrydate asc limit 0,5
```



### 执行顺序

![image-20240319090055182](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240319090055182.png)



```mysql
select e.name ename , e.age eage from emp e where e.age > 15 order by eage asc;
```







---

## DCL

 查询用户

```mysql
use mysql;
select * from mysql.user;
```

创建用户

```mysql
create user 'itcast'@'主机名' identified by '密码';
```

修改用户密码

```mysql
alter user 'itcase'@'主机名'identified with mysql_native_password by '新密码';
-- 本地密码处理方式
```

删除用户

```mysql
drop user'用户名'@'主机名'
```

主机名可以用%来进行匹配，表示任意主机



**权限管理**

查询权限

```mysql
show grants for '用户名'@'主机';
```

授予权限

```mysql
grant 权限列表 on 数据库名.表名 to '用户名'@'主机'
```

撤销权限

```mysql
revoke 权限列表 on 数据库名.表名 from '用户名'@'主机'
```



## 函数

### 字符串函数

![image-20240319102655791](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240319102655791.png)

```mysql
select CONCAT('hello',' ','world','!');

select LOWER('HELLO');
select UPPER('hello');

-- 字符串填充注意
select LPAD('str',5,'abc');
select RPAD('str',5,'abcdef');

select TRIM('  1231234sffda  ');

-- 截取字符串 索引是从1开始的
select SUBSTRING('123456abcdef',2,5);
```

![image-20240326101410919](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240326101410919.png)



----



### 数值函数

![image-20240319102716959](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240319102716959.png)

```mysql
select CEIL(1.3);
select FLOOR(1.3);
select MOD(5,2);
select RAND();
select ROUND(4.5893423,3);
```



---



### 日期函数

![image-20240326095816051](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240326095816051.png)

```mysql
select CURDATE();	# 日期
select CURTIME(); 	# 时间
select NOW(); 		# 日期+时间

select YEAR(NOW());
select MONTH(NOW());
select DAY(NOW());

select DATE_ADD(NOW(),INTERVAL 20 YEAR);

# 前-后
select DATEDIFF('2023-3-26','2033-5-15');
```



---



### 流程函数

基本函数

![image-20240326102922208](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240326102922208.png)

应用

```mysql
select IF(true,'ok','no');
select IF(false,'ok','no');

select IFNULL('not null','null');
select IFNULL(null,'null');
select IFNULL('','Default'); # 第一空非NULL

select name,
( CASE workaddress WHEN '北京' then '一线城市' WHEN '上海' then '一线城市' else '二线城市'end ) '工作地址'
from emp;

select id,name,
( CASE WHEN age>=20 && age<=30 then'年轻' WHEN age>30 then '中年' end )
from emp;
```



---



## 约束

![image-20240326104607136](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240326104607136.png)

`AUTO_INCREMENT`每次添加数据自动加1，id等较多使用

```mysql
create table tb_user(
	id int primary key auto_increment, # 顺序可调
	name varchar(10) not null unique,
    age int check(age > 0 && age <= 120),
    status char(1) default '1',
    gender char(1)
);
```

![image-20240326160842217](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240326160842217.png)



**外键约束**

![image-20240326161028937](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240326161028937.png)

删除dept部门表，但是员工表对应的部门编号仍然存在，员工表对应的数据本应该也被删除，为了保证数据表的完整性，此时需添加外键约束

```mysql
# 表内添加外键
CREATE TABLE 表名(
 字段名 数据类型,
 ...
 [CONSTRAINT] [外键名称] FOREIGN KEY (外键字段名) REFERENCES 主表 (主表列名) 
);

# 表外添加外键
ALTER TABLE 表名 ADD CONSTRAINT 外键名称 FOREIGN KEY (外键字段名) 
REFERENCES 主表 (主表列名) ;
```



**外键案例**

```mysql
# 数据准备
create table dept(
 id int auto_increment comment 'ID' primary key,
 name varchar(50) not null comment '部门名称'
)comment '部门表';

INSERT INTO dept (id, name) VALUES (1, '研发部'), (2, '市场部'),(3, '财务部'), (4, 
'销售部'), (5, '总经办');

create table dept_emp(
 id int auto_increment comment 'ID' primary key,
 name varchar(50) not null comment '姓名',
 age int comment '年龄',
 job varchar(20) comment '职位',
 salary int comment '薪资',
 entrydate date comment '入职时间',
 managerid int comment '直属领导ID',
 dept_id int comment '部门ID'
)comment '员工表';

INSERT INTO dept_emp (id, name, age, job,salary, entrydate, managerid, dept_id) 
VALUES
 (1, '金庸', 66, '总裁',20000, '2000-01-01', null,5),
 (2, '张无忌', 20, '项目经理',12500, '2005-12-05', 1,1),
 (3, '杨逍', 33, '开发', 8400,'2000-11-03', 2,1),
 (4, '韦一笑', 48, '开发',11000, '2002-02-05', 2,1),
 (5, '常遇春', 43, '开发',10500, '2004-09-07', 3,1),(6, '小昭', 19, '程序员鼓励师',6600, '2004-10-12', 2,1);

```

```Mysql
# 给员工表添加部门外键
alter table dept_emp add constraint fk_dept_emp_dept_id foreign key (dept_id) references dept(id);
```



添加外键后，删除父表会产生约束，删除子表没事

![image-20240326194210427](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240326194210427.png)



**删除外键**

```mysql
ALTER TABLE 表名 DROP FOREIGN KEY 外键名称;
```

删除/更新 父表 

![image-20240326195135306](C:\Users\hxd15\AppData\Roaming\Typora\typora-user-images\image-20240326195135306.png)



```mysql
# 用法
ALTER TABLE 表名 ADD CONSTRAINT 外键名称 FOREIGN KEY (外键字段) REFERENCES 主表名 (主表字段名) ON UPDATE CASCADE ON DELETE CASCADE;

alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references dept(id) on update set null on delete set null ;
```





---

## 多表查询

```mysql
# 正常合并查询出现的笛卡尔积需要消除
select * from dept_emp,dept;
# 出现的数据远大于数据表实际存储
```



### 内连接

```mysql
# 隐式内连
select * from dept_emp ,dept where dept_emp.dept_id = dept.id;

# 显示内连
select * from dept_emp [inter] join dept on dept_id = dept.id;
```



### 外连接

```mysql
# 左外
select e.* ,d.name '部门' from dept_emp e left outer join dept d on e.dept_id = d.id;

# 右外
select d.name ,e.* from dept d right outer join dept_emp e on d.id = e.dept_id;

# 注意书写顺序，即可达到右外=左外
```



### 自连接

```mysql
select e1.name ,e2.name from dept_emp e1 , dept_emp e2 where e1.managerid = e2.id;

# 别名
select e1.name '员工',e2.name '领导' from dept_emp e1 left outer join dept_emp e2 on e1.managerid = e2.id;

```





### 联合连接

```mysql
select e1.* from dept_emp e1 where age >= 50
union # all    +all不去重
select e2.* from dept_emp e2 where salary <= 5000;
```

union [all]





子表查询







## 事务

```
transaction
```



























# 进阶

数据库Linux版本下载

[MySQL :: Download MySQL Community Server (Archived Versions)](https://downloads.mysql.com/archives/community/)

![image-20240416095015710](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416095015710.png)

打开finalshell，将下载文件上传，然后进行解压

![image-20240416095052027](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416095052027.png)



1.  创建一个文件夹 `mkdir mysql`
2. 输入指令解压`tar -xvf mysql-8.2.0-1.el9.x86_64.rpm-bundle.tar -C mysql` 并将压缩包解压到mysql下



存储引擎









### 索引

主键索引					primary

唯一索引					unique

常规索引					无

全文索引					fulltext



**聚集索引**

- 存在主键，主键为聚集索引
- 不存在主键，取第一个唯一索引
- 二者均无，系统自动生成rowid作为隐藏索引

**二级索引**

查找二级索引时，会根据二级索引查到主键值然后再到聚集索引中进行回表聚集索引查询，即回表查询









#### 索引语法

```mysql
# 创建索引
CREATE [UNIQUE | FULLTEXT] INDEX idex_name ON table_name(idex_col_name,……);

create index index_user_name on tb_user2(name);
---------
# 查看索引
SHOW INDEX FROM table_name ;

show index from tb_user2;
---------
# 删除索引
DROP INDEX index_name ON table_name ;

drop index index_user_nmae on tb_user2;
```



##### 试验表

```mysql
create table tb_user2(
 id int primary key auto_increment comment '主键',
 name varchar(50) not null comment '用户名',
 phone varchar(11) not null comment '手机号',
 email varchar(100) comment '邮箱',
 profession varchar(11) comment '专业',
 age tinyint unsigned comment '年龄',
 gender char(1) comment '性别 , 1: 男, 2: 女',
 status char(1) comment '状态',
 createtime datetime comment '创建时间'
) comment '系统用户表';
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('吕布', '17799990000', 'lvbu666@163.com', '软件工程', 23, '1', 
'6', '2001-02-02 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('曹操', '17799990001', 'caocao666@qq.com', '通讯工程', 33, 
'1', '0', '2001-03-05 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('赵云', '17799990002', '17799990@139.com', '英语', 34, '1', 
'2', '2002-03-02 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('孙悟空', '17799990003', '17799990@sina.com', '工程造价', 54, 
'1', '0', '2001-07-02 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('花木兰', '17799990004', '19980729@sina.com', '软件工程', 23, 
'2', '1', '2001-04-22 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('大乔', '17799990005', 'daqiao666@sina.com', '舞蹈', 22, '2', 
'0', '2001-02-07 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('露娜', '17799990006', 'luna_love@sina.com', '应用数学', 24, 
'2', '0', '2001-02-08 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('程咬金', '17799990007', 'chengyaojin@163.com', '化工', 38, 
'1', '5', '2001-05-23 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('项羽', '17799990008', 'xiaoyu666@qq.com', '金属材料', 43, 
'1', '0', '2001-09-18 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('白起', '17799990009', 'baiqi666@sina.com', '机械工程及其自动
化', 27, '1', '2', '2001-08-16 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('韩信', '17799990010', 'hanxin520@163.com', '无机非金属材料工
程', 27, '1', '0', '2001-06-12 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('荆轲', '17799990011', 'jingke123@163.com', '会计', 29, '1', 
'0', '2001-05-11 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('兰陵王', '17799990012', 'lanlinwang666@126.com', '工程造价', 
44, '1', '1', '2001-04-09 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('狂铁', '17799990013', 'kuangtie@sina.com', '应用数学', 43, 
'1', '2', '2001-04-10 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('貂蝉', '17799990014', '84958948374@qq.com', '软件工程', 40, 
'2', '3', '2001-02-12 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('妲己', '17799990015', '2783238293@qq.com', '软件工程', 31, 
'2', '0', '2001-01-30 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('芈月', '17799990016', 'xiaomin2001@sina.com', '工业经济', 35, 
'2', '0', '2000-05-03 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('嬴政', '17799990017', '8839434342@qq.com', '化工', 38, '1', 
'1', '2001-08-08 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('狄仁杰', '17799990018', 'jujiamlm8166@163.com', '国际贸易', 
30, '1', '0', '2007-03-12 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('安琪拉', '17799990019', 'jdodm1h@126.com', '城市规划', 51, 
'2', '0', '2001-08-15 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('典韦', '17799990020', 'ycaunanjian@163.com', '城市规划', 52, 
'1', '2', '2000-04-12 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('廉颇', '17799990021', 'lianpo321@126.com', '土木工程', 19, 
'1', '3', '2002-07-18 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('后羿', '17799990022', 'altycj2000@139.com', '城市园林', 20, 
'1', '0', '2002-03-10 00:00:00');
INSERT INTO tb_user2 (name, phone, email, profession, age, gender, status, 
createtime) VALUES ('姜子牙', '17799990023', '37483844@qq.com', '工程造价', 29, 
'1', '4', '2003-05-26 00:00:00');
```



##### **需求**

A. name字段为姓名字段，该字段的值可能会重复，为该字段创建索引。

B. phone手机号字段的值，是非空，且唯一的，为该字段创建唯一索引。 

C. 为profession、age、status创建联合索引。 

D. 为email建立合适的索引来提升查询效率。  

完成上述的需求之后，我们再查看tb_user表的所有的索引数据。



```mysql
create index index_user_name on tb_user2(name);

create unique index index_user_phone on tb_user2(phone);

create index index_user_pro_age_sta on tb_user2(profession,age,status);

create index index_email on tb_user2(email);

#删除姓名索引
drop index index_name on tb_user2;
```



---



### SQL性能分析

#### SQL执行频率

可以通过`show [session|global] status`查询数据库各操作频率（增删改查）注：需要字符匹配，否则会出现其他非常多数据

![image-20240416144453628](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416144453628.png)



```mysql
-- session 是查看当前会话 ;
-- global 是查询全局数据 ;
SHOW GLOBAL STATUS LIKE 'Com_______'; # 7
```

![image-20240416144555981](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416144555981.png)





#### 慢查询日志

慢日志查询可以看到所有执行SQL时间超过指定参数的日志（秒）

默认不开启 slow_query_log = 0;

通过命令`show variables like 'slow_query_log'` 查看慢日志是否开启

![image-20240416145326407](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416145326407.png)

---

MySQL的配置文件（/etc/my.cnf）中将信息修改，如下

`vi /etc/my.cnf`

```mysql
# 开启MySQL慢日志查询开关
slow_query_log=1

# 设置慢日志的时间为2秒，SQL语句执行时间超过2秒，就会视为慢查询，记录慢查询日志
long_query_time=2
```

然后系统会生成一个文件/var/lib/mysql/localhost-slow.log 记录信息

退出重启`systemctl restart mysqld`



#### profile详情

profile可以帮助我们知道SQL语句执行时，时间具体都耗费到哪些地方

通过`select @@have_profiling` 查看profile是否开启

`set profiling = 1` 开启(需要权限)



```mysql
-- 查看每一条SQL的耗时基本情况
show profiles;

-- 查看指定query_id的SQL语句各个阶段的耗时情况
show profile for query query_id;

-- 查看指定query_id的SQL语句CPU的使用情况
show profile cpu for query query_id;
```



![image-20240416152152557](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416152152557.png)





![image-20240416152341534](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416152341534.png)





![image-20240416152407183](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416152407183.png)



#### explain

通过命令查看Mysql如何执行select语句，以及性能等

```mysql
-- 直接在select语句之前加上关键字 explain / desc
EXPLAIN SELECT 字段列表 FROM 表名 WHERE 条件 ;
```



![image-20240416163024745](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416163024745.png)



主键索引查询会出现const，如果不是主键则会出现ref

![image-20240416161639896](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416161639896.png)



 

主要关注

![image-20240416162140609](C:\Users\hxd15\Desktop\Repository\GithubRepository\assets\image-20240416162140609.png)
